<!DOCTYPE html>
<html lang="en">

<head>  
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EduGameHub</title>
    <link rel="stylesheet" href="home.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">

</head>

<body>
    <div class="main">
        <!-- Navbar -->
        <nav class="navbar navbar-expand-lg ">
            <div class="container-fluid">
                <a class="navbar-brand fw-bold" href="#">üéì EduGameHub</a>
                <!-- Hamburger Button -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                    data-bs-target="#navbarSupportedContent">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navbar Links -->
                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                    <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                        <li class="nav-item">
                            <a class="nav-link active" href="#">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Leaderboard</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                More Options
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#">‚öôÔ∏è Settings</a></li>
                                <li><a class="dropdown-item" href="#">üèÜ Points</a></li>
                                <li>
                                    <hr class="dropdown-divider">
                                </li>
                                <li><a class="dropdown-item" href="#">üë§ Account Info</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link disabled">Disabled</a>
                        </li>
                    </ul>

                    <!-- Search Box -->
                    <form class="d-flex" role="search">
                        <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                        <button class="btn" type="submit">Search</button>
                    </form>

                    <form action="login.html" class="d-flex">
                        <button class="logout btn" >Logout</button>
                    </form>
                </div>
            </div>
        </nav>


        <div class="sideBar">
            <h4 class="sidebar-title">Select Grade</h4>
            <div class="grade-buttons">
               
                <button class="grade-btn" data-grade="6">Grade 6</button>
                <button class="grade-btn" data-grade="7">Grade 7</button>
                <button class="grade-btn" data-grade="8">Grade 8</button>
                <button class="grade-btn" data-grade="9">Grade 9</button>
                <button class="grade-btn" data-grade="10">Grade 10</button>
                <button class="grade-btn" data-grade="11">Grade 11</button>
                <button class="grade-btn" data-grade="12">Grade 12</button>
            </div>
        </div>

        <div class="mainContent">
            <!-- Welcome Screen -->
            <div id="welcome-screen" class="content-section">
                <div class="welcome-header">
                    <h2>üéì EduGameHub - STEM Learning</h2>
                    <p>Select a grade from the sidebar to explore STEM subjects and take quizzes!</p>
                </div>
                <div class="features-grid">
                    <div class="feature-card">
                        <h4>üî¨ Science</h4>
                        <p>Explore biology, chemistry, physics, and earth sciences</p>
                    </div>
                    <div class="feature-card">
                        <h4>üî¢ Mathematics</h4>
                        <p>Master algebra, geometry, calculus, and statistics</p>
                    </div>
                    <div class="feature-card">
                        <h4>‚öôÔ∏è Technology</h4>
                        <p>Learn programming, engineering, and digital skills</p>
                    </div>
                    <div class="feature-card">
                        <h4>üèóÔ∏è Engineering</h4>
                        <p>Understand design, construction, and problem-solving</p>
                    </div>
                </div>
            </div>

            <!-- Subject Selection Screen -->
            <div id="subject-selection" class="content-section" style="display: none;">
                <div class="section-header">
                    <h2>Grade <span id="selected-grade">6</span> - Choose a Subject</h2>
                    <button id="back-to-grades" class="back-btn">‚Üê Back to Grades</button>
                </div>
                <div class="subjects-grid">
                    <div class="subject-card" data-subject="science">
                        <div class="subject-icon">üî¨</div>
                        <h3>Science</h3>
                        <p id="science-description">Biology, Chemistry, Physics, Earth Science</p>
                        <div class="subject-actions">
                            <button class="subject-btn" data-subject="science">Start Quiz</button>
                            <button class="flashcards-btn" data-subject="science">Start Flashcards</button>
                        </div>
                    </div>
                    <div class="subject-card" data-subject="mathematics">
                        <div class="subject-icon">üî¢</div>
                        <h3>Mathematics</h3>
                        <p id="math-description">Algebra, Geometry, Statistics, Problem Solving</p>
                        <div class="subject-actions">
                            <button class="subject-btn" data-subject="mathematics">Start Quiz</button>
                            <button class="flashcards-btn" data-subject="mathematics">Start Flashcards</button>
                            <button class="shooter-btn" data-subject="mathematics">Play Math Shooter</button>
                        </div>
                    </div>
                    <div class="subject-card" data-subject="technology">
                        <div class="subject-icon">‚öôÔ∏è</div>
                        <h3>Technology</h3>
                        <p id="tech-description">Programming, Computer Science, Digital Skills</p>
                        <div class="subject-actions">
                            <button class="subject-btn" data-subject="technology">Start Quiz</button>
                            <button class="flashcards-btn" data-subject="technology">Start Flashcards</button>
                        </div>
                    </div>
                    <div class="subject-card" data-subject="engineering">
                        <div class="subject-icon">üèóÔ∏è</div>
                        <h3>Engineering</h3>
                        <p id="eng-description">Design, Construction, Problem Solving, Innovation</p>
                        <div class="subject-actions">
                            <button class="subject-btn" data-subject="engineering">Start Quiz</button>
                            <button class="flashcards-btn" data-subject="engineering">Start Flashcards</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quiz Screen -->
            <div id="quiz-screen" class="content-section" style="display: none;">
                <div class="quiz-header">
                    <h2 id="quiz-title">Grade <span id="quiz-grade">6</span> - <span id="quiz-subject">Science</span> Quiz</h2>
                    <div class="quiz-stats">
                        <span class="stat">Question <span id="current-q">1</span> of <span id="total-qs">10</span></span>
                        <span class="stat">Score: <span id="score">0</span></span>
                        <span class="stat">Time: <span id="timer">30</span>s</span>
                    </div>
                    <button id="back-to-subjects" class="back-btn">‚Üê Back to Subjects</button>
                </div>
                
                <div class="progress-container">
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress"></div>
                    </div>
                </div>

                <div class="question-container">
                    <h3 id="question-text">Loading question...</h3>
                    <div class="options-container" id="options">
                        <!-- Options will be dynamically generated -->
                    </div>
                </div>

                <div class="quiz-controls">
                    <button id="next-question" class="quiz-btn" disabled>Next Question</button>
                    <button id="submit-quiz" class="quiz-btn" style="display: none;">Submit Quiz</button>
                </div>
            </div>

            <!-- Results Screen -->
            <div id="results-screen" class="content-section" style="display: none;">
                <div class="results-header">
                    <h2>üéâ Quiz Complete!</h2>
                    <div class="score-display">
                        <h3>Your Score: <span id="final-score">0</span>/<span id="max-score">10</span></h3>
                        <div class="percentage" id="percentage">0%</div>
                    </div>
                </div>
                
                <div class="results-info">
                    <div class="result-item">
                        <h4>üìä Performance</h4>
                        <p id="performance">Great job!</p>
                    </div>
                    <div class="result-item">
                        <h4>‚è±Ô∏è Time Taken</h4>
                        <p id="time-taken">0 minutes</p>
                    </div>
                    <div class="result-item">
                        <h4>üéØ Accuracy</h4>
                        <p id="accuracy">0%</p>
                    </div>
                </div>

                <div class="results-actions">
                    <button id="retry-quiz" class="action-btn">Retry Quiz</button>
                    <button id="new-subject" class="action-btn">Try Different Subject</button>
                    <button id="new-grade" class="action-btn">Choose Different Grade</button>
                </div>
            </div>

            <!-- Flashcards Screen -->
            <div id="flashcards-screen" class="content-section" style="display: none;">
                <div class="quiz-header">
                    <h2 id="flashcards-title">Grade <span id="flashcards-grade">6</span> - <span id="flashcards-subject">Science</span> Flashcards</h2>
                    <div class="quiz-stats">
                        <span class="stat">Card <span id="current-card">1</span> of <span id="total-cards">10</span></span>
                    </div>
                    <button id="back-to-subjects-from-flashcards" class="back-btn">‚Üê Back to Subjects</button>
                </div>

                <div class="flashcard-container">
                    <div class="flashcard" id="flashcard">
                        <div class="flashcard-inner" id="flashcard-inner">
                            <div class="flashcard-face flashcard-front" id="flashcard-front">Loading...</div>
                            <div class="flashcard-face flashcard-back" id="flashcard-back">Answer</div>
                        </div>
                    </div>
                </div>

                <div class="quiz-controls">
                    <button id="prev-card" class="quiz-btn">Prev</button>
                    <button id="flip-card" class="quiz-btn">Flip</button>
                    <button id="next-card" class="quiz-btn">Next</button>
                </div>
            </div>

            <!-- Math Shooter Screen -->
            <div id="shooter-screen" class="content-section" style="display: none;">
                <div class="quiz-header">
                    <h2>Grade <span id="shooter-grade">6</span> - Mathematics Shooter</h2>
                    <div class="shooter-stats">
                        <span class="stat">Score: <span id="shooter-score">0</span></span>
                        <span class="stat">Lives: <span id="shooter-lives">3</span></span>
                        <span class="stat">Solve: <span id="shooter-problem">1 + 1 = ?</span></span>
                    </div>
                    <button id="back-to-subjects-from-shooter" class="back-btn">‚Üê Back to Subjects</button>
                </div>

                <div class="shooter-container">
                    <canvas id="shooter-canvas" width="900" height="500"></canvas>
                </div>

                <div class="control-hint">Use ‚Üê ‚Üí or A/D to move, Space to shoot the correct answer.</div>
            </div>
        </div>


    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // STEM Questions Database
        const stemQuestions = {
            6: {
                science: [
                    {
                        question: "What is the process by which plants make their own food?",
                        options: ["Respiration", "Photosynthesis", "Digestion", "Fermentation"],
                        correct: 1,
                        explanation: "Photosynthesis is how plants convert sunlight into energy."
                    },
                    {
                        question: "Which planet is closest to the Sun?",
                        options: ["Venus", "Earth", "Mercury", "Mars"],
                        correct: 2,
                        explanation: "Mercury is the closest planet to the Sun in our solar system."
                    },
                    {
                        question: "What is the chemical symbol for water?",
                        options: ["H2O", "CO2", "NaCl", "O2"],
                        correct: 0,
                        explanation: "Water is made of two hydrogen atoms and one oxygen atom (H2O)."
                    }
                ],
                mathematics: [
                    {
                        question: "What is 15 + 27?",
                        options: ["40", "42", "41", "43"],
                        correct: 1,
                        explanation: "15 + 27 = 42"
                    },
                    {
                        question: "What is the area of a rectangle with length 8 and width 5?",
                        options: ["13", "26", "40", "35"],
                        correct: 2,
                        explanation: "Area = length √ó width = 8 √ó 5 = 40"
                    },
                    {
                        question: "What is 6 √ó 7?",
                        options: ["42", "36", "48", "49"],
                        correct: 0,
                        explanation: "6 √ó 7 = 42"
                    }
                ],
                technology: [
                    {
                        question: "What does CPU stand for?",
                        options: ["Central Processing Unit", "Computer Processing Unit", "Central Program Unit", "Computer Program Unit"],
                        correct: 0,
                        explanation: "CPU stands for Central Processing Unit, the brain of the computer."
                    },
                    {
                        question: "What is the main purpose of RAM in a computer?",
                        options: ["Long-term storage", "Temporary storage", "Display graphics", "Connect to internet"],
                        correct: 1,
                        explanation: "RAM provides temporary storage for data the computer is actively using."
                    },
                    {
                        question: "What does 'www' stand for in a website address?",
                        options: ["World Wide Web", "World Web Wide", "Wide World Web", "Web World Wide"],
                        correct: 0,
                        explanation: "WWW stands for World Wide Web, the global information system."
                    }
                ],
                engineering: [
                    {
                        question: "What is the main purpose of a bridge?",
                        options: ["To store water", "To cross obstacles", "To generate electricity", "To provide shelter"],
                        correct: 1,
                        explanation: "Bridges are designed to help people and vehicles cross obstacles like rivers or valleys."
                    },
                    {
                        question: "What type of engineer designs buildings?",
                        options: ["Mechanical engineer", "Civil engineer", "Electrical engineer", "Chemical engineer"],
                        correct: 1,
                        explanation: "Civil engineers design and construct buildings, bridges, and infrastructure."
                    },
                    {
                        question: "What is the strongest shape used in construction?",
                        options: ["Circle", "Triangle", "Square", "Rectangle"],
                        correct: 1,
                        explanation: "Triangles are the strongest shape because they distribute force evenly."
                    }
                ]
            }
        };

        // Application State
        let currentGrade = null;
        let currentSubject = null;
        let currentQuestionIndex = 0;
        let score = 0;
        let timeLeft = 30;
        let timer = null;
        let selectedAnswer = null;
        let startTime = null;
        let currentCardIndex = 0;
        let isCardFlipped = false;
        // Shooter state
        let shooterState = {
            running: false,
            score: 0,
            lives: 3,
            playerX: 450,
            bullets: [], // {x, y, vy}
            answers: [], // {x, y, vy, value, isCorrect}
            problem: { a: 1, b: 1, op: '+', correct: 2 },
            keys: {}
        };

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeEventListeners();
        });

        function initializeEventListeners() {
            // Grade button functionality
            const gradeButtons = document.querySelectorAll('.grade-btn');
            gradeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    selectGrade(parseInt(this.getAttribute('data-grade')));
                });
            });

            // Subject selection
            document.querySelectorAll('.subject-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectSubject(this.getAttribute('data-subject'));
                });
            });

            // Flashcards start buttons
            document.querySelectorAll('.flashcards-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    selectSubjectForFlashcards(this.getAttribute('data-subject'));
                });
            });

            // Shooter start (only for mathematics)
            document.querySelectorAll('.shooter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    if (!currentGrade) {
                        alert('Please select a grade first.');
                        return;
                    }
                    startShooter();
                });
            });

            // Navigation buttons
            document.getElementById('back-to-grades').addEventListener('click', showWelcomeScreen);
            document.getElementById('back-to-subjects').addEventListener('click', showSubjectSelection);
            document.getElementById('back-to-subjects-from-flashcards').addEventListener('click', showSubjectSelection);
            document.getElementById('back-to-subjects-from-shooter').addEventListener('click', stopShooterAndBack);
            document.getElementById('retry-quiz').addEventListener('click', startQuiz);
            document.getElementById('new-subject').addEventListener('click', showSubjectSelection);
            document.getElementById('new-grade').addEventListener('click', showWelcomeScreen);

            // Quiz controls
            document.getElementById('next-question').addEventListener('click', nextQuestion);
            document.getElementById('submit-quiz').addEventListener('click', submitQuiz);

            // Flashcards controls
            document.getElementById('flip-card').addEventListener('click', flipFlashcard);
            document.getElementById('next-card').addEventListener('click', nextCard);
            document.getElementById('prev-card').addEventListener('click', prevCard);

            // Shooter controls
            window.addEventListener('keydown', (e) => {
                shooterState.keys[e.key.toLowerCase()] = true;
                if (e.code === 'Space') {
                    e.preventDefault();
                    shootBullet();
                }
            });
            window.addEventListener('keyup', (e) => {
                shooterState.keys[e.key.toLowerCase()] = false;
            });
        }

        function selectGrade(grade) {
            // Remove selected class from all buttons
            const gradeButtons = document.querySelectorAll('.grade-btn');
            gradeButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Add selected class to clicked button
            event.target.classList.add('selected');
            
            currentGrade = grade;
            showSubjectSelection();
        }

        function showSubjectSelection() {
            // Update grade display
            document.getElementById('selected-grade').textContent = currentGrade;
            
            // Show subject selection, hide others
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'block';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('flashcards-screen').style.display = 'none';
        }

        function selectSubject(subject) {
            currentSubject = subject;
            startQuiz();
        }

        function selectSubjectForFlashcards(subject) {
            currentSubject = subject;
            startFlashcards();
        }

        function startQuiz() {
            if (!currentGrade || !currentSubject || !stemQuestions[currentGrade] || !stemQuestions[currentGrade][currentSubject]) {
                alert('Please select a valid grade and subject.');
                return;
            }

            // Reset quiz state
            currentQuestionIndex = 0;
            score = 0;
            timeLeft = 30;
            selectedAnswer = null;
            startTime = Date.now();

            // Update UI
            document.getElementById('quiz-grade').textContent = currentGrade;
            document.getElementById('quiz-subject').textContent = currentSubject.charAt(0).toUpperCase() + currentSubject.slice(1);
            document.getElementById('total-qs').textContent = stemQuestions[currentGrade][currentSubject].length;
            document.getElementById('max-score').textContent = stemQuestions[currentGrade][currentSubject].length;
            
            // Show quiz screen, hide others
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'block';
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('flashcards-screen').style.display = 'none';
            document.getElementById('shooter-screen').style.display = 'none';

            // Load first question
            loadQuestion();
        }

        function startFlashcards() {
            if (!currentGrade || !currentSubject || !stemQuestions[currentGrade] || !stemQuestions[currentGrade][currentSubject]) {
                alert('Please select a valid grade and subject.');
                return;
            }

            currentCardIndex = 0;
            isCardFlipped = false;

            document.getElementById('flashcards-grade').textContent = currentGrade;
            document.getElementById('flashcards-subject').textContent = currentSubject.charAt(0).toUpperCase() + currentSubject.slice(1);
            document.getElementById('total-cards').textContent = stemQuestions[currentGrade][currentSubject].length;

            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('flashcards-screen').style.display = 'block';

            renderFlashcard();
        }

        function renderFlashcard() {
            const cards = stemQuestions[currentGrade][currentSubject];
            const card = cards[currentCardIndex];

            document.getElementById('current-card').textContent = currentCardIndex + 1;

            const front = document.getElementById('flashcard-front');
            const back = document.getElementById('flashcard-back');
            front.textContent = card.question;
            back.innerHTML = `<strong>Answer:</strong> ${card.options[card.correct]}<br/><em>${card.explanation || ''}</em>`;

            // reset flip state
            isCardFlipped = false;
            document.getElementById('flashcard-inner').classList.remove('flipped');
        }

        function flipFlashcard() {
            isCardFlipped = !isCardFlipped;
            const inner = document.getElementById('flashcard-inner');
            if (isCardFlipped) {
                inner.classList.add('flipped');
            } else {
                inner.classList.remove('flipped');
            }
        }

        function nextCard() {
            const cards = stemQuestions[currentGrade][currentSubject];
            if (currentCardIndex < cards.length - 1) {
                currentCardIndex++;
                renderFlashcard();
            }
        }

        function prevCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                renderFlashcard();
            }
        }

        function loadQuestion() {
            const questions = stemQuestions[currentGrade][currentSubject];
            const question = questions[currentQuestionIndex];
            
            // Update progress
            document.getElementById('current-q').textContent = currentQuestionIndex + 1;
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progress').style.width = progress + '%';

            // Update question text
            document.getElementById('question-text').textContent = question.question;

            // Clear and populate options
            const optionsContainer = document.getElementById('options');
            optionsContainer.innerHTML = '';
            question.options.forEach((option, index) => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.addEventListener('click', () => selectOption(index, button));
                optionsContainer.appendChild(button);
            });

            // Reset controls
            document.getElementById('next-question').disabled = true;
            document.getElementById('next-question').style.display = 'inline-block';
            document.getElementById('submit-quiz').style.display = 'none';
            selectedAnswer = null;

            // Start timer
            startTimer();
        }

        function selectOption(optionIndex, buttonElement) {
            // Remove previous selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.classList.remove('selected');
            });

            // Select current option
            buttonElement.classList.add('selected');
            selectedAnswer = optionIndex;

            // Enable next button
            document.getElementById('next-question').disabled = false;
        }

        function startTimer() {
            timeLeft = 30;
            document.getElementById('timer').textContent = timeLeft;
            document.getElementById('timer').classList.remove('timer-warning');

            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('timer').textContent = timeLeft;

                // Warning when time is running low
                if (timeLeft <= 10) {
                    document.getElementById('timer').classList.add('timer-warning');
                }

                // Time's up
                if (timeLeft <= 0) {
                    clearInterval(timer);
                    timeUp();
                }
            }, 1000);
        }

        function timeUp() {
            // Show correct answer
            showCorrectAnswer();
            
            // Disable option selection
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.style.pointerEvents = 'none';
            });

            // Show next/submit button
            const questions = stemQuestions[currentGrade][currentSubject];
            if (currentQuestionIndex < questions.length - 1) {
                document.getElementById('next-question').disabled = false;
            } else {
                document.getElementById('submit-quiz').style.display = 'inline-block';
            }
        }

        function showCorrectAnswer() {
            const questions = stemQuestions[currentGrade][currentSubject];
            const question = questions[currentQuestionIndex];
            const correctIndex = question.correct;

            document.querySelectorAll('.option-btn').forEach((btn, index) => {
                if (index === correctIndex) {
                    btn.classList.add('correct');
                } else if (index === selectedAnswer && selectedAnswer !== correctIndex) {
                    btn.classList.add('incorrect');
                }
            });

            // Update score if correct
            if (selectedAnswer === correctIndex) {
                score++;
                document.getElementById('score').textContent = score;
            }
        }

        function nextQuestion() {
            clearInterval(timer);
            
            const questions = stemQuestions[currentGrade][currentSubject];
            if (currentQuestionIndex < questions.length - 1) {
                currentQuestionIndex++;
                loadQuestion();
            } else {
                submitQuiz();
            }
        }

        function submitQuiz() {
            clearInterval(timer);
            showResults();
        }

        function showResults() {
            const questions = stemQuestions[currentGrade][currentSubject];
            const totalQuestions = questions.length;
            const percentage = Math.round((score / totalQuestions) * 100);
            const timeTaken = Math.round((Date.now() - startTime) / 1000 / 60);

            // Update results
            document.getElementById('final-score').textContent = score;
            document.getElementById('percentage').textContent = percentage + '%';
            document.getElementById('time-taken').textContent = timeTaken + ' minutes';
            document.getElementById('accuracy').textContent = percentage + '%';

            // Performance feedback
            let performance = '';
            if (percentage >= 90) {
                performance = 'Outstanding! You have excellent knowledge!';
            } else if (percentage >= 80) {
                performance = 'Great job! You have good knowledge!';
            } else if (percentage >= 70) {
                performance = 'Good work! Keep studying to improve!';
            } else if (percentage >= 60) {
                performance = 'Not bad! Review the topics and try again!';
            } else {
                performance = 'Keep studying! Practice makes perfect!';
            }
            document.getElementById('performance').textContent = performance;

            // Show results, hide others
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'block';
        }

        function showWelcomeScreen() {
            // Reset grade selection
            const gradeButtons = document.querySelectorAll('.grade-btn');
            gradeButtons.forEach(btn => btn.classList.remove('selected'));
            
            // Show welcome screen, hide others
            document.getElementById('welcome-screen').style.display = 'block';
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('flashcards-screen').style.display = 'none';
            document.getElementById('shooter-screen').style.display = 'none';
            
            // Reset state
            currentGrade = null;
            currentSubject = null;
        }

        // Shooter Game
        function startShooter() {
            currentSubject = 'mathematics';
            // show screen
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('subject-selection').style.display = 'none';
            document.getElementById('quiz-screen').style.display = 'none';
            document.getElementById('results-screen').style.display = 'none';
            document.getElementById('flashcards-screen').style.display = 'none';
            document.getElementById('shooter-screen').style.display = 'block';

            // init state
            shooterState.running = true;
            shooterState.score = 0;
            shooterState.lives = 3;
            shooterState.playerX = 450;
            shooterState.bullets = [];
            shooterState.answers = [];
            shooterState.keys = {};
            updateShooterUI();
            generateProblemAndAnswers();

            // start loops
            shooterLoop();
            answerSpawnLoop();
        }

        function stopShooterAndBack() {
            shooterState.running = false;
            showSubjectSelection();
        }

        function updateShooterUI() {
            document.getElementById('shooter-grade').textContent = currentGrade || '';
            document.getElementById('shooter-score').textContent = shooterState.score;
            document.getElementById('shooter-lives').textContent = shooterState.lives;
            document.getElementById('shooter-problem').textContent = `${shooterState.problem.a} ${shooterState.problem.op} ${shooterState.problem.b} = ?`;
        }

        function generateProblemAndAnswers() {
            const ops = ['+', '-', '√ó'];
            const op = ops[Math.floor(Math.random() * ops.length)];
            let a = Math.floor(Math.random() * 10) + 1;
            let b = Math.floor(Math.random() * 10) + 1;
            let correct;
            if (op === '+') correct = a + b;
            else if (op === '-') correct = a - b;
            else correct = a * b;

            shooterState.problem = { a, b, op, correct };
            updateShooterUI();

            // clear existing answers
            shooterState.answers = [];
            // spawn one correct and 3 incorrect answers at random x positions
            const canvas = document.getElementById('shooter-canvas');
            const width = canvas.width;
            const choices = new Set([correct]);
            while (choices.size < 4) {
                const delta = Math.floor(Math.random() * 11) - 5; // -5..5
                let candidate = correct + delta;
                if (candidate === correct) candidate += (Math.random() < 0.5 ? -1 : 1) * (Math.floor(Math.random() * 3) + 1);
                choices.add(candidate);
            }
            const shuffled = Array.from(choices).sort(() => Math.random() - 0.5);
            shuffled.forEach((value) => {
                shooterState.answers.push({
                    x: 60 + Math.random() * (width - 120),
                    y: -Math.random() * 150 - 40,
                    vy: 1.2 + Math.random() * 0.8,
                    value,
                    isCorrect: value === correct
                });
            });
        }

        function shooterLoop() {
            if (!shooterState.running) return;
            const canvas = document.getElementById('shooter-canvas');
            const ctx = canvas.getContext('2d');

            // physics: move player
            const speed = 5;
            if (shooterState.keys['arrowleft'] || shooterState.keys['a']) shooterState.playerX -= speed;
            if (shooterState.keys['arrowright'] || shooterState.keys['d']) shooterState.playerX += speed;
            shooterState.playerX = Math.max(20, Math.min(canvas.width - 20, shooterState.playerX));

            // move bullets
            shooterState.bullets.forEach(b => b.y += b.vy);
            shooterState.bullets = shooterState.bullets.filter(b => b.y > -20);

            // move answers
            shooterState.answers.forEach(a => a.y += a.vy);

            // collisions bullets vs answers
            shooterState.bullets.forEach((b) => {
                shooterState.answers.forEach((a) => {
                    if (Math.abs(b.x - a.x) < 20 && Math.abs(b.y - a.y) < 20) {
                        b.y = -999; // mark for removal
                        a.y = canvas.height + 999; // mark for removal
                        if (a.isCorrect) {
                            shooterState.score += 10;
                            generateProblemAndAnswers();
                        } else {
                            shooterState.score = Math.max(0, shooterState.score - 5);
                        }
                        updateShooterUI();
                    }
                });
            });
            shooterState.bullets = shooterState.bullets.filter(b => b.y > -500);
            shooterState.answers = shooterState.answers.filter(a => a.y < canvas.height + 50);

            // answers reaching bottom
            shooterState.answers.forEach((a) => {
                if (a.y >= canvas.height - 40) {
                    if (a.isCorrect) {
                        shooterState.lives -= 1;
                        if (shooterState.lives <= 0) {
                            gameOverShooter();
                            return;
                        }
                        updateShooterUI();
                        generateProblemAndAnswers();
                    } else {
                        // wrong answer fell, just remove
                    }
                    a.y = canvas.height + 999;
                }
            });

            // render
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            // player ship
            ctx.fillStyle = '#e0e1dd';
            ctx.beginPath();
            ctx.moveTo(shooterState.playerX, canvas.height - 20);
            ctx.lineTo(shooterState.playerX - 15, canvas.height - 0);
            ctx.lineTo(shooterState.playerX + 15, canvas.height - 0);
            ctx.closePath();
            ctx.fill();

            // bullets
            ctx.fillStyle = '#ffb703';
            shooterState.bullets.forEach(b => {
                ctx.fillRect(b.x - 2, b.y - 10, 4, 10);
            });

            // answers
            shooterState.answers.forEach(a => {
                ctx.fillStyle = a.isCorrect ? '#2a9d8f' : '#457b9d';
                ctx.beginPath();
                ctx.arc(a.x, a.y, 18, 0, Math.PI * 2);
                ctx.fill();
                ctx.fillStyle = '#ffffff';
                ctx.font = '16px Segoe UI';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                ctx.fillText(String(a.value), a.x, a.y);
            });

            requestAnimationFrame(shooterLoop);
        }

        function shootBullet() {
            if (!shooterState.running) return;
            const canvas = document.getElementById('shooter-canvas');
            shooterState.bullets.push({ x: shooterState.playerX, y: canvas.height - 25, vy: -8 });
        }

        function answerSpawnLoop() {
            if (!shooterState.running) return;
            // Occasionally add extra wrong answers to increase challenge
            if (Math.random() < 0.3) {
                const canvas = document.getElementById('shooter-canvas');
                const width = canvas.width;
                const wrong = shooterState.problem.correct + (Math.random() < 0.5 ? -1 : 1) * (Math.floor(Math.random() * 5) + 1);
                shooterState.answers.push({
                    x: 60 + Math.random() * (width - 120),
                    y: -40,
                    vy: 1.5 + Math.random() * 0.8,
                    value: wrong,
                    isCorrect: false
                });
            }
            setTimeout(answerSpawnLoop, 1200);
        }

        function gameOverShooter() {
            shooterState.running = false;
            alert(`Game Over! Your score: ${shooterState.score}`);
            showSubjectSelection();
        }
    </script>
</body>

</html>